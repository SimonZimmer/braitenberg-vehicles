<!DOCTYPE html>

<html>

	<head>
		<meta charset="utf-8">
		<br><br>
		<title>Braitenberg-Simulation</title>
		<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.13/semantic.min.css">
		<link rel="stylesheet" type="text/css" href="braitenberg.css"/>
		<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.13/semantic.min.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
		<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/d3/4.1.1/d3.min.js"></script>
		<script src="collision.js"></script>
		<script src="vehicles.js"></script>
		<script src="environment.js"></script>
	
		<style>

			.field {
  			pointer-events: none;
			}
		</style>
	</head>

	<body>
		<!-- Header -->
  	<div id="headingBar">
  		<h1>Braitenberg Playground</h1>
			<h2>Braitenberg Playground is a Simulation of the Braitenberg vehicles, as described by Valentin Braitenberg in: „Vehikel. Experimente mit künstlichen Wesen“.<br>
			tweak the global paramters in at the top and switch between different generations and configurations at the bottom </h2>
  	</div>

	  <div id="content">

		<!-- Top Controls -->
		<div id="top-controls">
	    <div class="mini grey circular ui icon buttons">
	    	<button onclick="simulation.restart()" class="ui button" id=reset-button title="reset the simulation"><i class="play icon"></i></button>
	    	<button onclick="simulation.stop()" class="ui button" id=pause-button title="pause the simulation"><i class="pause icon"></i></button>
	    </div>
			<div class="mini ui input">
	  		<input type="number" name="inputV"placeholder="number of vehicles" id=InVehicles>
			</div>
			<div class="mini ui input">
				<input type="number" name="inputL"placeholder="number of lights" id=InLights>
			</div>

	  	<label for="slidMinVelocity">min. speed:&nbsp;&nbsp;<g id="chosen1">50&nbsp;&nbsp;&nbsp;</g><span class="value"></span></label>
	  	<input type="range" name="slider1" min="1" max="100" value="50" class="slider" id="slidMinVelocity">
			<label for="slidMaxVelocity">max. speed:&nbsp;&nbsp;<g id="chosen2">50&nbsp;&nbsp;&nbsp;</g><span class="value"></span></label>
			<input type="range" name="slider2" min="1" max="100" value="50" class="slider" id="slidMaxVelocity">
			<label for="slidSensorSens">sensibility:&nbsp;&nbsp;<g id="chosen3">50&nbsp;&nbsp;&nbsp;</g><span class="value"></span></label>
			<input type="range" name="slider3" min="1" max="100" value="50" class="slider" id="slidSensorSens">
			<button onclick="ticked()" class="mini grey ui button" id=apply-button title="apply changes">apply</button>
		</div>

		<div class=main id="area1"</a></div>

		<div class= main id="tabs">
			<div class="ui top attached tabular menu">
			  <a class="item active" data-tab="first">Generation 1 </a>
			  <a class="item" data-tab="second">Generation 2</a>
			  <a class="item" data-tab="third">Generation 3 </a>
			  <a class="item" data-tab="fourth">Generation 4 </a>
			</div>
			<div class="ui bottom attached tab segment active" data-tab="first">
			  <b>Vehicle 1: getting around</b> <br><br>
			  Temperature Sensor, Motor, Brownian Function<br>
			  Alive. Moves around restlessly. Likes Cold. Not Smart.<br><br>
				<svg 
					xmlns="http://www.w3.org/2000/svg" id="vehicle1" width="109" height="163" viewBox="0 0 109 163"><style>.a{fill:#F0F0F0;}.b{stroke-width:2;stroke:#3B3B3B;}</style><defs><rect y="18" width="42" height="136" rx="2"/><rect x="9" y="133" width="24" height="42" rx="2"/></defs><g fill="none"><g transform="translate(53.936533 81.277223)rotate(30)translate(-53.936533 -81.277223)translate(32.936533 -6.222777)"><use xlink:href="#path-1" class="a"/><rect x="0.8" y="18.8" width="40.5" height="134.5" rx="2" class="b"/><use xlink:href="#path-2" class="a"/><rect x="9.8" y="133.8" width="22.5" height="40.5" rx="2" class="b"/><path d="M20.8 9.5L20.8 133" class="b"/><path d="M34 0.7C30 6.4 26 9.2 21.8 9.2 17.7 9.2 13.5 6.4 9.3 0.7" class="b"/></g></g>
				</svg>
			</div>

			<div class="ui bottom attached tab segment" data-tab="second">
			  <b>Vehicle 2: Fear/Agression</b> <br><br>
			  2 Light/Temp Sensors + Motors <br>
			  Coward: flees from light/temperature <br>
			  Agressor: fährt auf Licht zu <br><br>
				<svg 
					xmlns="http://www.w3.org/2000/svg" id="vehicle2a" width="149" height="171" viewBox="0 0 149 171"><style>.a{fill:#F0F0F0;}.b{stroke-width:2;stroke:#3B3B3B;}.c{fill:#3B3B3B;}</style><defs><rect x="11" y="17" width="84" height="136" rx="2"/><rect y="105" width="24" height="42" rx="2"/><rect x="82" y="105" width="24" height="42" rx="2"/></defs><g fill="none"><g transform="translate(81.149346 83.750943)rotate(30)translate(-81.149346 -83.750943)translate(28.149346 7.250943)"><use xlink:href="#path-1" class="a"/><rect x="11.8" y="17.8" width="82.5" height="134.5" rx="2" class="b"/><use xlink:href="#path-2" class="a"/><rect x="0.8" y="105.8" width="22.5" height="40.5" rx="2" class="b"/><use xlink:href="#path-3" class="a"/><rect x="82.8" y="105.8" width="22.5" height="40.5" rx="2" class="b"/><path d="M86.7 0C82.7 5.7 78.6 8.6 74.5 8.6 70.4 8.6 66.2 5.7 62 0" class="b"/><path d="M43.1 0C39.1 5.7 35 8.6 30.9 8.6 26.8 8.6 22.6 5.7 18.4 0" class="b"/><path d="M74 8.7C74 71.3 74 105.1 74 110 74 114.9 76.8 117.4 82.4 117.4" class="b"/><path d="M31.4 9C31.4 71.6 31.4 105.3 31.4 110.3 31.4 115.2 28.6 117.7 23 117.7" class="b"/><text font-family="AvenirNext-Regular, Avenir Next" font-size="19.1578947" class="c"><tspan x="25" y="137">  +</tspan></text><text font-family="AvenirNext-Regular, Avenir Next" font-size="19.1578947" class="c"><tspan x="69" y="140.5">  +</tspan></text></g></g>
				</svg>
				<svg 
					xmlns="http://www.w3.org/2000/svg" id="vehicle2b" width="149" height="172" viewBox="0 0 149 172"><style>.a{fill:#F0F0F0;}.b{stroke-width:2;stroke:#3B3B3B;}.c{fill:#3B3B3B;}</style><defs><rect x="11" y="17" width="84" height="136" rx="2"/><rect y="105" width="24" height="42" rx="2"/><rect x="82" y="105" width="24" height="42" rx="2"/></defs><g fill="none"><g transform="translate(81.149346 84.750943)rotate(30)translate(-81.149346 -84.750943)translate(28.149346 8.250943)"><use xlink:href="#path-1" class="a"/><rect x="11.8" y="17.8" width="82.5" height="134.5" rx="2" class="b"/><use xlink:href="#path-2" class="a"/><rect x="0.8" y="105.8" width="22.5" height="40.5" rx="2" class="b"/><use xlink:href="#path-3" class="a"/><rect x="82.8" y="105.8" width="22.5" height="40.5" rx="2" class="b"/><path d="M86.7 0C82.7 5.7 78.6 8.6 74.5 8.6 70.4 8.6 66.2 5.7 62 0" class="b"/><path d="M42.7 0C38.7 5.7 34.6 8.6 30.5 8.6 26.4 8.6 22.2 5.7 18 0" class="b"/><text font-family="AvenirNext-Regular, Avenir Next" font-size="19.1578947" class="c"><tspan x="25" y="137">  +</tspan></text><text font-family="AvenirNext-Regular, Avenir Next" font-size="19.1578947" class="c"><tspan x="67" y="137">  +</tspan></text><path d="M82.8 118C83.5 118 82 118 78.4 118 53 117.8 30.3 108.1 30.3 48.7 30.3 28.8 30.3 15.4 30.3 8.5" class="b"/><path d="M22.9 117.5C22.3 117.5 23.7 117.5 27.3 117.5 52.3 117.3 74.7 107.6 74.7 48.2 74.7 28.3 74.7 14.9 74.7 8" class="b"/></g></g>
				</svg>
			</div>

			<div class="ui bottom attached tab segment" data-tab="third">
			  <b>Vehicle 3: Love</b> <br><br>
			</div>
			<div class="ui bottom attached tab segment" data-tab="fourth">
			  <b>Vehicle 4: Values/Tastes</b> <br><br>
			  Sensors: light, temperature, oxygene concentration, organic concentration <br>
			</div>
		</div>

		<!-- left part -->
		<div class="ui horizontal segments">
		  <div class="ui segment">
		  	<div id="leftpart">
		  	<div class='lp'>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Maecenas ornare porta nunc. Praesent vestibulum eleifend augue ut lacinia. Sed lectus lectus, tempor eu blandit nec, gravida non arcu. Sed quam ex, hendrerit vel risus at, accumsan ultricies ipsum. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Maecenas ornare porta nunc. Praesent vestibulum eleifend augue ut lacinia. Sed lectus lectus, tempor eu blandit nec, gravida non arcu. Sed quam ex, hendrerit vel risus at, accumsan ultricies ipsum. Praes
		  		Lorem ipsum dolor sit amet, consectetur adipiscing elit. Maecenas ornare porta nunc. Praesent vestibulum eleifend augue ut lacinia. Sed lectus lectus, tempor eu blandit nec, gravida non arcu. Sed quam ex, hendrerit vel risus at, accumsan ultricies ipsum. Praes
		  		Lorem ipsum dolor sit amet, consectetur adipiscing elit. Maecenas ornare porta nunc. Praesent vestibulum eleifend augue ut lacinia. Sed lectus lectus, tempor eu blandit nec, gravida non arcu. Sed quam ex, hendrerit vel risus at, accumsan ultricies ipsum.
		  	</div>
		  	</div>
			</div>
	<!-- 		right part	 -->	
			<div class="ui segment">
				<div id="rightpart">
				<div class='lp'>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Maecenas ornare porta nunc. Praesent vestibulum eleifend augue ut lacinia. Sed lectus lectus, tempor eu blandit nec, gravida non arcu. Sed quam ex, hendrerit vel risus at, accumsan ultricies ipsum. Praes Lorem ipsum dolor sit amet, consectetur adipiscing elit. Maecenas ornare porta nunc. Praesent vestibulum eleifend augue ut lacinia. Sed lectus lectus, tempor eu blandit nec, gravida non arcu. Sed quam ex, hendrerit vel risus at, accumsan ultricies ipsum. Praes Lorem ipsum dolor sit amet, consectetur adipiscing elit. Maecenas ornare porta nunc. Praesent vestibulum eleifend augue ut lacinia. Sed lectus lectus, tempor eu blandit nec, gravida non arcu. Sed quam ex, hendrerit vel risus at, accumsan ultricies ipsum. Praes Lorem ipsum dolor sit amet, consectetur adipiscing elit. Maecenas ornare porta nunc. Praesent vestibulum eleifend augue ut lacinia. Sed lectus lectus, tempor eu blandit nec, gravida non arcu. Sed quam ex, hendrerit vel risus at, accumsan ultricies ipsum.
				</div>
				</div>
			</div>
		</div>

		<div class=main id="area2"</a></div>

		<script>

		var width = 1127,
		    height = 500;
		    margin = 10;

		var minVelocity = 0.,
		    maxVelocity = 4.,
		    numVehicles = 2,
		    numLights = 3,
		    lightFactor = 100.,
		    lightDistance = 200.,
		    noisyMotion = 0.1;

		var vehicles_data = Array.apply(null, Array(numVehicles)).map(function (_, i) {
		  var v = 0;
		  return {
		    x: Math.random() * width,
		    y: Math.random() * height,
		    vx: 0,
		    vy: 0,
		    vl: v,
		    vr: v,
		    ang: Math.random()*Math.PI*2,
		  };
		});

		var lightsNumber = 0;
		var lights_data = Array.apply(null, Array(numLights)).map(function (_, i) {
		  lightsNumber += 1;
		  return {
		    x: Math.random() * width,
		    y: Math.random() * height,
		    strength: Math.random() * 1000 + 100,
		    distance: lightDistance,
		    id: "light" + lightsNumber,
		    color: "#FDDF75"
		  }
		})

		var svg = d3.select('#area1').append('svg')
		    .attr('width', width)
		    .attr('height', height)

		var defs = svg.append("defs");

		svg.append("rect")
		  .attr("width", width)
		  .attr("height", height)
		  .attr("fill", "#1D1F21")

		var [vehicles, simulation] = createVehicles(vehicles_data);
		var [light, lights] = createCircularLight(lights_data);

			// tab control
			$(document).ready(function(){
			   $('.ui .item').on('click', function() {
			      $('.ui .item').removeClass('active');
			      $(this).addClass('active');
			      var tab = $(this).attr("data-tab");
			    	$(".tab.segment").removeClass("active");
			    	$(".tab.segment[data-tab=\"" + tab + "\"]").addClass("active");
			   });             
			});	

			//slider control:
			var slider1 = document.getElementById('slidMinVelocity');
			slider1.addEventListener('input', sliderChange1);

			var slider2 = document.getElementById('slidMaxVelocity');
			slider2.addEventListener('input', sliderChange2);

			var slider3 = document.getElementById('slidSensorSens');
			slider3.addEventListener('input', sliderChange3);

			function sliderChange1() {
				var display = document.getElementById("chosen1");
				display.innerHTML=this.value;
				Vehicle.minVelocity = this.value;
  			console.log("min Velocitx Slider= " + this.value);
			}

			function sliderChange2() {
				var display = document.getElementById("chosen2");
				display.innerHTML=this.value;
				Vehicle.maxVelocity = this.value;
  			console.log("max Velocitx Slider= " + this.value);
			}

			function sliderChange3() {
				var display = document.getElementById("chosen3");
				display.innerHTML=this.value;
  			console.log(this.value);
			}

		</script>

	</body>
</html>